<template>
  <div class="analysis">

    <a-row  :gutter="[24, 24]" >
      <!-- 接通率 -->
      <a-col :sm="24" :md="12" :xl="5">
        <chart-card :loading="loading" :title="$t('nowjietonglv')" :total="otherDate.v1_1 ">
          <!--          <a-tooltip :title="$t('introduce01')" slot="action">-->
          <!--            <a-icon type="info-circle-o"/>-->
          <!--          </a-tooltip>-->
            <div>
              <a-select :default-value="user.pname" style="width: 130px;position: absolute;top: -110px;right: 0px"
                        @change="changeMini" >

                <a-select-option v-for="(item,index) in firstDepart" :key="index" :value="item.pname+','+item.id">
<!--                  <a-tooltip :title="item.pname" slot="action">-->
                    {{ item.pname }}
<!--                  </a-tooltip>-->
                </a-select-option>
              </a-select>


            </div>

            <div >
              <mini-area v-if="loadMini" :jietonglv="v1data"/>
            </div>
            <div v-if="loadMini" slot="footer">{{ $t('dianhualiang') }}<span> {{ (otherDate.v1_2)}} </span>
              <trend  style="margin-left: 1.5rem" :term="$t('reach')"  :percent="otherDate.v1_3" :is-increase="true" :scale="0"  v-if=" otherDate.v1_3 >= 100"/>
              <trend style="margin-left: 1.5rem"  :term="$t('reach')" :target="100" :value=" 100 - otherDate.v1_3 " :scale="0"  v-else/>
            </div>

        </chart-card>
      </a-col>



      <!-- 接通量 -->
      <a-col :sm="24" :md="12" :xl="5">
        <chart-card :loading="loading" :title=" $t('nowjietongliang')" :total="otherDate.v2_1">
          <a-tooltip :title="$t('introduce02') " slot="action">
            <a-icon type="info-circle-o"/>
          </a-tooltip>
          <div>
            <double-bar v-if="loadMini" :jietongliang="v2data"/>
          </div>
          <div v-if="loadMini" slot="footer">
            <span >{{ $t('average') }} {{otherDate.v2_2}} %</span>
            <trend style="margin-left: 1.5rem" :term="$t('reach')"  :percent="otherDate.v2_3" :is-increase="true" :scale="0"  v-if=" otherDate.v2_3 >= 100"/>
            <trend style="margin-left: 1.5rem"  :term="$t('reach')" :target="100" :value=" 100 - otherDate.v2_3 " :scale="0"  v-else/>
          </div>
        </chart-card>
      </a-col>

      <!-- 30/60秒时长 -->
      <a-col :sm="24" :md="12" :xl="5">
        <chart-card :loading="loading" :title="$t('secondliang')" :total="otherDate.v3_1 ">
                    <a-tooltip :title="$t('introduce05')" slot="action">
                      <a-icon type="info-circle-o"/>
                    </a-tooltip>

          <div>
            <sec-bar v-if="loadMini" :secdata="v3data"/>
          </div>
          <div v-if="loadMini" slot="footer">
            <span>{{ $t('average') }} {{ otherDate.v3_2}}</span>
            <trend style="margin-left: 0.7rem" :term="$t('reach')"  :percent="otherDate.v3_3" :is-increase="true" :scale="0"  v-if=" otherDate.v3_3 >= 100"/>
            <trend style="margin-left: 0.7rem"  :term="$t('reach')" :target="100" :value=" 100 - otherDate.v3_3 " :scale="0"  v-else/>
            /
            <trend    :percent="otherDate.v3_4" :is-increase="true" :scale="0"  v-if=" otherDate.v3_4 >= 100"/>
            <trend    :target="100" :value=" 100 - otherDate.v3_4 " :scale="0"  v-else/>

          </div>
        </chart-card>
      </a-col>


      <!-- 时长 -->
      <a-col :sm="24" :md="12" :xl="5">
        <chart-card :loading="loading" :title="$t('nowshichang')" :total="otherDate.v4_1">
          <a-tooltip :title="$t('introduce03')" slot="action">
            <a-icon type="info-circle-o"/>
          </a-tooltip>
          <div>
            <mini-bar v-if="loadMini" :tonghuatime="v4data"/>
          </div>
          <div v-if="loadMini" slot="footer">
            <span>{{ $t('average') }} {{ otherDate.v4_2 }}</span>
            <trend style="margin-left: 0.7rem" :term="$t('reach')"  :percent="otherDate.v4_3" :is-increase="true" :scale="0"  v-if=" otherDate.v4_3 >= 100"/>
            <trend style="margin-left: 0.7rem"  :term="$t('reach')" :target="100" :value=" 100 - otherDate.v4_3 " :scale="0"  v-else/>
          </div>
        </chart-card>
      </a-col>

      <!-- 费用 -->
      <a-col :sm="24" :md="12" :xl="4"  >
        <chart-card :loading="loading" :title="$t('nowmoney')" :total="'¥' + otherDate.v5_1.toFixed(2)">
          <a-tooltip :title="$t('introduce04')" slot="action">
            <a-icon type="info-circle-o"/>
          </a-tooltip>

          <h1 style="font-weight: bolder" v-if="(isCost == 0) && (user.isAd == 0)">未设置费用明细</h1>
          <h1 style="font-weight: bolder" v-if="isCost == 0  && (user.isAd >= 1)" @click="setCost">去设置费用明细 <a-icon type="tool" theme="twoTone" /></h1>

          <div  v-if="isCost != 0">
            <mini-progress v-if="loadMini" :target="costFix" :residue="otherDate.v5_1" />
          </div>
          <div v-if="loadMini" slot="footer" style="white-space: nowrap;overflow: hidden">
            <span>{{ $t('average') }} {{otherDate.v5_3}}</span>

            <trend style="margin-left: 0.7rem" :term="$t('reach')"  :percent="otherDate.v5_4" :is-increase="true" :scale="0"  v-if=" otherDate.v5_4 >= 100"/>
            <trend style="margin-left: 0.7rem"  :term="$t('reach')" :target="100" :value=" 100 - otherDate.v5_4 " :scale="0"  v-else/>
          </div>
        </chart-card>
      </a-col>
    </a-row>

    <a-card :loading="loading" style="margin-top: 24px;height:1100px" :bordered="false" :body-style="{padding: '24px'}">
      <div class="salesCard">
        <a-tabs default-active-key="1"  size="large" :tab-bar-style="{marginBottom: '24px', paddingLeft: '16px'}" @change="changeTab" style="height: 1100px">

          <div class="extra-wrap" slot="tabBarExtraContent" v-if="tabValue == 1">
            <a-button  type="primary" @click="showModal" style="width: 180px;margin-right: 100px">
              生成日报
            </a-button>
            <a-modal v-model="visible" title="外呼智能日报" @ok="onCopy" >
              <template slot="footer">
                <a-button key="back" @click="handleCancel">
                  确定
                </a-button>
                <a-button key="submit" type="primary"
                          v-clipboard:copy="'外呼智能日报:'+dayRepart"
                          v-clipboard:success="onCopy"
                          v-clipboard:error="onError">
                  复制日报
                </a-button>
              </template>
              <h3>{{dayRepart}}</h3>

            </a-modal>
          </div>


          <a-tab-pane :loading="loading" tab="分公司内比" key="1" >

            <div style="margin-top: -10px">
              <a-row >
                <a-col :span="20">
                  <div>
                    <a-radio-group default-value="a" button-style="solid" @change="typeChange">
                      <a-radio-button value="a">
                        日详情
                      </a-radio-button>
                      <a-radio-button value="b">
                        日环比
                      </a-radio-button>
                      <a-radio-button value="c">
                        周环比
                      </a-radio-button>

                    </a-radio-group>

                    <a-date-picker v-if="typeValue == 'a'" :defaultValue="moment(viewDate,'YYYY-MM-DD')" @change="dateChange01" style="margin-left: 5px" :disabled-date="disableDate"/>

                    <a-week-picker v-if="typeValue == 'c'" placeholder="查看周数据对应日期" style="margin-left: 5px" />

                    <a-select v-show="typeValue == 'a'" :default-value="user.pname" style="width: 220px;margin-left: 5px;z-index: 92"
                              @change="departChange01">
                      <a-select-option v-for="(item,index) in firstDepart" :key="index" :value="item.pname+','+item.id">
                          {{ item.pname }}
                      </a-select-option>
                    </a-select>


                    <a-select v-show="typeValue == 'b'" :default-value="user.pname" style="width: 220px;margin-left: 5px;z-index: 92"
                              @change="departChange02">
                      <a-select-option v-for="(item,index) in firstDepart" :key="index" :value="item.pname+','+item.id">
                          {{ item.pname }}
                      </a-select-option>
                    </a-select>


                    <a-select v-show="typeValue == 'c'" :default-value="user.pname" style="width: 220px;margin-left: 5px;z-index: 92"
                              @change="departChange03">
                      <a-select-option v-for="(item,index) in firstDepart" :key="index" :value="item.pname+','+item.id">
                          {{ item.pname }}
                      </a-select-option>
                    </a-select>

                    <a-button  type="primary" @click="changeBig" style="width: 180px;;margin-left: 5px">
                      查询
                    </a-button>
                  </div>
                </a-col>
              </a-row>
            </div>

<!--            日详情-->
            <a-row style="margin-top: 20px"  v-if="typeValue == 'a'">
              <a-col :span="16" style="z-index: 90">
                <left-bar v-if="loadBig"  title="分公司接通量（单位：通)"  :jtl="v1Bigdata" :phone-amount="title.phoneAmount" :phone-done="title.phoneDone" />
              </a-col>

              <a-col :span="8" >
                <right-jtl v-if="loadBig" title="分公司接通率（单位：%）" style="margin-left: -200px"  :rightDate="v2Bigdata" :jtlv="title.jtlv"></right-jtl>
              </a-col>

              <a-col :span="8" style="margin-top: 10px">
                <left-bardw  v-if="loadBig"  title=" 分公司30/60秒量（单位：通）" :leftdw-data="v3Bigdata" :s30="title.amount30s" :s60="title.amount60s"/>
              </a-col>

              <a-col :span="8" style="margin-top: 10px;z-index: 100">

                <timedw v-if="loadBig"  title="分公司通话时长（单位：秒）" :time-data="v4Bigdata" :time-amount="title.timeAmount"></timedw>

              </a-col>

              <a-col :span="8" style="margin-top: 10px;z-index: 99">

                <right-jtldw  v-if="loadBig" title="分公司费用（单位：元）" :money-data="v5Bigdata" :money-amount="title.moneyAmount"></right-jtldw>

              </a-col>

            </a-row>


<!--            日环比-->
            <a-row style="margin-top: 20px"   v-if="typeValue == 'b'">
              <a-col :span="12" >

                <ri-huanbi v-if="loadBig02"  title="接通率日环比" :huanbiV1Data="huanbiV1Data" height="350"/>
              </a-col>

              <a-col :span="12" >

                <left-bar v-if="loadBig02" title="接通量部门环比"  :jtl="huanbiV2Data"  />

              </a-col>

              <a-col :span="12" >
                <double-barld v-if="loadBig02"  title="接通量分类环比"  :samount="huanbiV3Data"/>
              </a-col>

              <a-col :span="12" >

                <left-bar v-if="loadBig02"   title="电话时长环比"  :jtl="huanbiV4Data"/>

              </a-col>

            </a-row>

            <!--            周环比-->
            <a-row style="margin-top: 20px"   v-if="typeValue == 'c'">
              <a-col :span="12" >

                <ri-huanbi v-if="loadBig03"  title="接通率周环比" :huanbiV1Data="zhuanbiV1Data" height="350"/>
              </a-col>

              <a-col :span="12" >

                <left-bar v-if="loadBig03" title="接通量部门环比"  :jtl="zhuanbiV2Data"  />

              </a-col>

              <a-col :span="12" >
                <double-barld v-if="loadBig03"  title="接通量分类环比"  :samount="zhuanbiV3Data"/>
              </a-col>

              <a-col :span="12" >

                <left-bar v-if="loadBig03"   title="电话时长环比"  :jtl="zhuanbiV4Data"/>

              </a-col>

            </a-row>

          </a-tab-pane>
          <a-tab-pane tab="分公司外比" key="2">

            <div style="margin-top: -10px">
              <a-row >
                <a-col :span="20">
                  <div>

                    <a-date-picker :defaultValue="moment(viewDate02,'YYYY-MM-DD')" :disabled-date="disableDate" @change="onChange" style="margin-left: 5px"/>

                    <a-button  type="primary" @click="changeOutDate" style="width: 180px;;margin-left: 5px">
                      查询
                    </a-button>
                  </div>
                </a-col>
              </a-row>
            </div>

            <a-row style="margin-top: 20px">
              <a-col :xl="16" :lg="12" :md="12" :sm="24" :xs="24">
                <ri-huanbi v-if="loadOut"  title="接通率外部环比" :huanbiV1Data="outV1Data"  height="400"/>
              </a-col>
              <a-col :xl="8" :lg="12" :md="12" :sm="24" :xs="24">
                <ranking-list v-if="loadOut" :title="'接通率top榜:' + bigviewDate02" :list="outV2Data"/>
              </a-col>
              <a-col :xl="12" :lg="12" :md="12" :sm="24" :xs="24">
                <out-comparev3 v-if="loadOut" :title="'接通量外部环比:'+ bigviewDate02" :out-v3-data="outV3Data"></out-comparev3>
              </a-col>
              <a-col :xl="12" :lg="12" :md="12" :sm="24" :xs="24">
                <out-comparev4 v-if="loadOut" :title="'接通量外部环比:'+ bigviewDate02" :out-v4-data="outV4Data"></out-comparev4>
              </a-col>
            </a-row>
          </a-tab-pane> 
        </a-tabs>
      </div>
    </a-card>

  </div>
</template>

<script>
import ChartCard from '../../../components/card/ChartCard'
import RankingList from '../../../components/mychart/RankingList'
import Trend from '../../../components/chart/Trend'

//我的插件
import MiniArea from '../../../components/mychart/MiniArea'
import DoubleBar from '../../../components/mychart/DoubleBar.vue'
import MiniBar from '../../../components/mychart/MiniBar'
import SecBar from '../../../components/mychart/SecBar'
import MiniProgress from '../../../components/mychart/MiniProgress'
import RightJtl from '../../../components/mychart/RightJtl';
import LeftBar from '../../../components/mychart/LeftBar';
import LeftBardw from '../../../components/mychart/LeftBardw';
import RightJtldw from '../../../components/mychart/RightJtldw';
import Timedw from '../../../components/mychart/Timedw';

//日环比
import RiHuanbi from '../../../components/mychart/RihuanbiLu'
import DoubleBarld from '../../../components/mychart/DoubleBarld.vue'

//周环比
import OutComparev3 from '../../../components/mychart/OutComparev3.vue'
import OutComparev4 from '../../../components/mychart/OutComparev4.vue'


import {getAll,getMini,getBig,getDayCompare,getWeekCompare,getOutCompare} from "@/services/user";


//获取vuex数据
import {mapGetters} from 'vuex'
import moment from "moment"




export default {
  name: 'Analysis',
  i18n: require('./i18n'),
  data() {
    return {
      loading: true,
      loadBig:true,
      loadBig02 : true,
      loadBig03 : true,

      loadOut : true,

      loadMini:true,

      bigDate:new Date(),
      viewDate:"",
      bigviewDate:"",

      viewDate02:"",
      bigviewDate02:"",

      paramPid:0,
      paramPname:"",

      paramPid02:0,
      paramPname02:"",

      paramPid03:0,
      paramPname03:"",
      //一级部门数据
      firstDepart:[],

      otherDate:{
        v1_1:0,
        v1_2:0,
        v1_3:0,
        v2_1:0,
        v2_2:0,
        v2_3:0,
        v3_1:0,
        v3_2:0,
        v3_3:0,
        v3_4:0,
        v4_1:0,
        v4_2:0,
        v4_3:0,
        v5_1:0,
        v5_2:0,
        v5_3:0,
        v5_4:0,
        v5_5:0
      },

      //是否设置了费用
      isCost : 1,
      costFix:0,
      v1data:[],
      v2data:[],
      v3data:[],
      v4data:[],

      v1Bigdata:[],
      v2Bigdata:[],
      v3Bigdata:[],
      v4Bigdata:[],
      v5Bigdata:[],
      title:{},

      huanbiV1Data:[],
      huanbiV2Data:[],
      huanbiV3Data:[],
      huanbiV4Data:[],

      zhuanbiV1Data:[],
      zhuanbiV2Data:[],
      zhuanbiV3Data:[],
      zhuanbiV4Data:[],

      //分公司外部比较数据
      outV1Data:[],
      outV2Data:[],
      outV3Data:[],
      outV4Data:[],



      //分公司数选择器假数据
      treeData : [],
      value: undefined,

      visible: false,

    //  视图切换value
      typeValue:'a',
      tabValue : 1,
      //日报数据
      dayRepart:'暂无数据'

    }
  },
  watch: {
    value(value) {
      console.log(value)
    },
  },
  computed:{
    ...mapGetters('account', ['user']),
  },
  methods: {
    moment,

    //跳转至费用设置界面
    setCost(){
      this.$router.push('/setting/setpage')
    },

    //实时地区选择器
    changeMini(value) {
      this.loadMini = false
      const valueList = value.toString().split(",");
      var formdata = {};
      formdata["pname"] = valueList[0];
      formdata["pid"] = valueList[1];

      formdata["viewDate"] = this.viewDate;
      var formdataSt = JSON.stringify(formdata)
      getMini(formdataSt).then( (response)=> {
        const resdata =  response.data.data.mini;
        this.isCost = resdata.costData.isCost;
        this.costFix = resdata.costData.costFix;
        this.v1data = resdata.v1;
        this.v2data = resdata.v2;
        this.v3data = resdata.v3;
        this.v4data = resdata.v4;

        const temp = resdata.otherDate
        this.otherDate={
          v1_1: temp.v1_1 ? temp.v1_1 : 0,
          v1_2:temp.v1_2 ? temp.v1_2.toFixed(0) : 0,
          v1_3:temp.v1_3 ? temp.v1_3 : 0,
          v2_1:temp.v2_1 ? temp.v2_1.toFixed(2) : 0,
          v2_2:temp.v2_2 ? temp.v2_2.toFixed(2) : 0,
          v2_3:temp.v2_3 ? temp.v2_3: 0,
          v3_1:temp.v3_1 ? temp.v3_1 : 0,
          v3_2:temp.v3_2 ? temp.v3_2 : 0,
          v3_3:temp.v3_3 ? temp.v3_3 : 0,
          v3_4:temp.v3_4 ? temp.v3_4 : 0,
          v4_1:temp.v4_1 ? temp.v4_1.toFixed(0): 0,
          v4_2:temp.v4_2 ? temp.v4_2.toFixed(0) : 0,
          v4_3:temp.v4_3 ? temp.v4_3 : 0,
          v5_1:temp.v5_1 ? temp.v5_1 : 0,
          v5_2:temp.v5_2 ? temp.v5_2 : 0,
          v5_3:temp.v5_3 ? temp.v5_3.toFixed(2) : 0,
          v5_4:temp.v5_4 ? temp.v5_4 : 0,
          v5_5:temp.v5_5 ? temp.v5_5 : 0
        }
        this.loadMini = true
      })
    },

    typeChange(res){
      var formdata = {};
      var formdataSt = ""
      this.typeValue = res.target.value
      if((this.typeValue == "b") && (this.huanbiV1Data.length == 0)){
        this.loadBig02 = false;

        formdata["pname"] = this.paramPname02;
        formdata["limit"] = 12;
        formdataSt = JSON.stringify(formdata)
        getDayCompare(formdataSt).then( (response)=> {
          const resdata = response.data.data;
          this.huanbiV1Data = resdata.huanbiV1Data
          this.huanbiV2Data = resdata.huanbiV2Data
          this.huanbiV3Data = resdata.huanbiV3Data
          this.huanbiV4Data = resdata.huanbiV4Data
          this.loadBig02 = true;
        })

      }else if((this.typeValue == "c") && (this.zhuanbiV1Data.length == 0)){
        this.loadBig03 = false;

        formdata["pname"] = this.paramPname03;
        formdata["limit"] = 12;
        formdataSt = JSON.stringify(formdata)
        getWeekCompare(formdataSt).then( (response)=> {
          const resdata = response.data.data;
          this.zhuanbiV1Data = resdata.zhuanbiV1Data
          this.zhuanbiV2Data = resdata.zhuanbiV2Data
          this.zhuanbiV3Data = resdata.zhuanbiV3Data
          this.zhuanbiV4Data = resdata.zhuanbiV4Data
          this.loadBig03 = true;
        })
      }
    },

    //内比日详情日期
    dateChange01(date, dateString) {
      this.bigDate = date;
      this.bigviewDate = dateString;
    },

    //内比日详情部门
    departChange01(value) {
      const valueList = value.toString().split(",");
      this.paramPname = valueList[0];
      this.paramPid = valueList[1];


    },

    //内比日详情部门
    departChange02(value) {
      const valueList = value.toString().split(",");
      this.paramPname02 = valueList[0];
      this.paramPid02 = valueList[1];
    },

    //内比日详情部门
    departChange03(value) {
      const valueList = value.toString().split(",");
      this.paramPname03 = valueList[0];
      this.paramPid03 = valueList[1];
    },

    //设置时间选择器的上限（今天）
    disableDate(end){
      if(new Date() < new Date(end)){
        return true

      }else{
        return  false
      }
    },

    //实时地区选择器
    changeBig() {
      var formdata = {};
      var formdataSt = ""
      if(this.typeValue == "a"){
        this.loadBig = false
        formdata["pname"] = this.paramPname;
        formdata["pid"] = this.paramPid;
        formdata["viewDate"] = this.bigviewDate;

        var h ;
        if(this.viewDate == this.bigviewDate){
          h = new Date().getHours()
        }else{
          h = 24
        }
        formdata["h"] = h;
        formdataSt = JSON.stringify(formdata)
        getBig(formdataSt).then( (response)=> {
          const resBigdata = response.data.data.big;
          this.v1Bigdata = resBigdata.leftData
          this.v2Bigdata = resBigdata.rightData
          this.v3Bigdata = resBigdata.leftdwData
          this.v4Bigdata = resBigdata.timeViewData
          this.v5Bigdata = resBigdata.moneyViewData
          this.title = resBigdata.titleData
          this.loadBig = true

        })
      }else if(this.typeValue == "b"){
        this.loadBig02 = false;
        formdata["pname"] = this.paramPname02;
        formdata["limit"] = 12;
        formdataSt = JSON.stringify(formdata)
        getDayCompare(formdataSt).then( (response)=> {
          const resdata = response.data.data;
          this.huanbiV1Data = resdata.huanbiV1Data
          this.huanbiV2Data = resdata.huanbiV2Data
          this.huanbiV3Data = resdata.huanbiV3Data
          this.huanbiV4Data = resdata.huanbiV4Data
          this.loadBig02 = true;
        })
      }else if(this.typeValue == "c"){
        this.loadBig03 = false;
        formdata = {};
        formdata["pname"] = this.paramPname03;
        formdata["limit"] = 12;
        formdataSt = JSON.stringify(formdata)
        getWeekCompare(formdataSt).then( (response)=> {
          const resdata = response.data.data;
          this.zhuanbiV1Data = resdata.zhuanbiV1Data
          this.zhuanbiV2Data = resdata.zhuanbiV2Data
          this.zhuanbiV3Data = resdata.zhuanbiV3Data
          this.zhuanbiV4Data = resdata.zhuanbiV4Data
          this.loadBig03 = true;
        })
      }

    },

    //外比日期选择

    onChange(date, dateString) {
      this.bigDate = date;
      this.bigviewDate02 = dateString;
    },

    //切换内比外比
    changeTab(res){
      this.tabValue = res;
      if((res == 2) && (this.outV1Data.length == 0)){
        var formdata = {};
        var formdataSt = ""
          this.loadOut = false
          formdata["limit"] = 12
          formdata["viewDate"] = this.bigviewDate02;

          formdataSt = JSON.stringify(formdata)
          getOutCompare(formdataSt).then( (response)=> {
            const outData = response.data.data;
            this.outV1Data = outData.outV1Data;
            this.outV2Data = outData.outV2Data;
            this.outV3Data = outData.outV3Data;
            this.outV4Data = outData.outV4Data;
            this.loadOut = true

          })
      }
    },

    changeOutDate(){
        var formdata = {};
        var formdataSt = ""
        this.loadOut = false
        formdata["limit"] = 12
        formdata["viewDate"] = this.bigviewDate02;

        formdataSt = JSON.stringify(formdata)
        getOutCompare(formdataSt).then( (response)=> {
          const outData = response.data.data;
          this.outV1Data = outData.outV1Data;
          this.outV2Data = outData.outV2Data;
          this.outV3Data = outData.outV3Data;
          this.outV4Data = outData.outV4Data;
          this.loadOut = true

        })
    },
    showModal() {
      this.visible = true;
      this.dayRepart = "截止"+this.viewDate + "日" + new Date().getHours() +"点：  合计接通量/拨打量："+ this.otherDate.v1_1 + "，接通率：" +
                        this.otherDate.v2_1 + "%，预计话费：" + this.otherDate.v5_1.toFixed(2) + "元"
    },

    handleCancel(){
      this.visible = false;
    },

    onCopy(){
      this.visible = false;
      this.$message.success('日报复制成功！');
    },
    onError(){

    },
    // handleOk(e) {
    //   this.visible = false;
    //   console.log(e)
    // },


  },
  created() {
    this.loadMini = false;
    this.loadBig = false
    this.paramPid = this.user.pid;
    this.paramPname = this.user.pname;
    this.paramPid02 = this.user.pid;
    this.paramPname02 = this.user.pname;
    this.paramPid03 = this.user.pid;
    this.paramPname03 = this.user.pname;
    var formdata = {};
    formdata["pid"] = this.user.pid;
    formdata["pname"] = this.user.pname;
    var nowDate = new Date();
    var month = (nowDate.getMonth() + 1) < 10 ? ("0" + (nowDate.getMonth() + 1)) : (nowDate.getMonth() + 1)
    var day = nowDate.getDate() < 10 ? ("0" + nowDate.getDate()) : nowDate.getDate()
    this.viewDate =  nowDate.getFullYear()+"-"+month+"-"+day
    this.bigviewDate =  nowDate.getFullYear()+"-"+month+"-"+day

    //分公司外比的时间
    this.viewDate02 = this.viewDate
    this.bigviewDate02 =   this.bigviewDate
    // var h = nowDate.getHours();
    formdata["viewDate"] = this.viewDate;
    var formdataSt = JSON.stringify(formdata)
    getAll(formdataSt).then( (response) =>{
      const resdata =  response.data.data.mini;
      const resBigdata = response.data.data.big;

      this.firstDepart = response.data.data.firstDepart;
      this.v1data = resdata.v1;
      this.v2data = resdata.v2;
      this.v3data = resdata.v3;
      this.v4data = resdata.v4;
      // //第一个小图的峰值数据
      // if(response.data.data.jtldata){
      //   this.otherPeak = response.data.data.jtldata.otherData;
      //   this.jietonglv = response.data.data.jtldata.jietonglv;
      //
      // }
      const temp = resdata.otherDate
      this.isCost = resdata.costData.isCost;
      this.costFix = resdata.costData.costFix;
      this.otherDate={
            v1_1: temp.v1_1 ? temp.v1_1 : 0,
            v1_2:temp.v1_2 ? temp.v1_2.toFixed(0) : 0,
            v1_3:temp.v1_3 ? temp.v1_3 : 0,
            v2_1:temp.v2_1 ? temp.v2_1.toFixed(2) : 0,
            v2_2:temp.v2_2 ? temp.v2_2.toFixed(2) : 0,
            v2_3:temp.v2_3 ? temp.v2_3: 0,
            v3_1:temp.v3_1 ? temp.v3_1 : 0,
            v3_2:temp.v3_2 ? temp.v3_2 : 0,
            v3_3:temp.v3_3 ? temp.v3_3 : 0,
            v3_4:temp.v3_4 ? temp.v3_4 : 0,
            v4_1:temp.v4_1 ? temp.v4_1.toFixed(0): 0,
            v4_2:temp.v4_2 ? temp.v4_2.toFixed(0) : 0,
            v4_3:temp.v4_3 ? temp.v4_3 : 0,
            v5_1:temp.v5_1 ? temp.v5_1 : 0,
            v5_2:temp.v5_2 ? temp.v5_2 : 0,
            v5_3:temp.v5_3 ? temp.v5_3.toFixed(2) : 0,
            v5_4:temp.v5_4 ? temp.v5_4 : 0,
            v5_5:temp.v5_5 ? temp.v5_5 : 0
      };

          this.v1Bigdata = resBigdata.leftData
          this.v2Bigdata = resBigdata.rightData
          this.v3Bigdata = resBigdata.leftdwData
          this.v4Bigdata = resBigdata.timeViewData
          this.v5Bigdata = resBigdata.moneyViewData
          this.title = resBigdata.titleData

          this.loadMini = true;
          this.loadBig = true;
          this.loading = !this.loading

    })

  //   setTimeout(()=>{
  //     this.xx = false
  //     setTimeout(()=>{
  //       this.x1 = 6;
  //       this.x2 = 18;
  //       this.xx = true
  //     },100)
  //   },5500)
  },
  components: {
    RightJtl,
    Trend,
    RankingList,
    MiniProgress,
    MiniArea,
    MiniBar,
    SecBar,
    DoubleBar,
    ChartCard,
    LeftBar,
    LeftBardw,
    RightJtldw,
    DoubleBarld,
    Timedw,
    RiHuanbi,
    OutComparev3,
    OutComparev4

  }
}
</script>

<style lang="less" scoped>
.extra-wrap {
  .extra-item {
    display: inline-block;
    margin-right: 24px;

    a:not(:first-child) {
      margin-left: 24px;
    }
  }
}

@media screen and (max-width: 992px) {
  .extra-wrap .extra-item {
    display: none;
  }
}

@media screen and (max-width: 576px) {
  .extra-wrap {
    display: none;
  }
}
</style>
